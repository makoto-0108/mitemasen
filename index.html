<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã¿ã¦ã¾ã›ã‚“ã€‚</title>
  <style>
    body {
      font-family: "Arial", sans-serif;
      background-color: #C8D5B9;
      color: #333;
      text-align: center;
      padding: 2em;
      max-width: 480px;
      margin: auto;
    }
    .container {
      background-color: #ffffffcc;
      border-radius: 1em;
      padding: 2em;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 2em;
    }
    .header-png {
      width: 100%;
      max-width: 300px;
      height: auto;
      display: block;
      margin: 0 auto 1em;
      border-radius: 1em;
    }
    @media (min-width: 768px) {
      .header-png {
        max-width: 200px;
      }
    }
    h1 {
      font-size: 1.8em;
      margin-bottom: 0.5em;
    }
    .points {
      font-size: 1.5em;
      margin-bottom: 1em;
    }
    button {
      font-size: 1em;
      padding: 0.6em 1.2em;
      margin: 0.5em;
      border: none;
      border-radius: 0.5em;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .good {
      background-color: #a3e4d7;
    }
    .bad {
      background-color: #f5b7b1;
    }
    .message {
      margin-top: 1em;
      font-size: 1.2em;
      min-height: 1.5em;
    }

    /* æ—¥ä»˜åˆ¥è¨˜éŒ²ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    form {
      margin-bottom: 1em;
      text-align: left;
      background: #fff;
      padding: 1em;
      border-radius: 0.6em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin: 0.5em 0 0.3em;
      font-weight: bold;
    }
    input[type="date"],
    input[type="number"] {
      width: 100%;
      padding: 0.4em;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 0.4em;
      box-sizing: border-box;
    }
    #countTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1em;
      background: #fff;
      border-radius: 0.6em;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    #countTable th,
    #countTable td {
      border: 1px solid #ccc;
      padding: 0.6em 0.8em;
      text-align: center;
    }
    #countTable th {
      background-color: #a3e4d7;
      color: #333;
    }
    button.edit {
      background-color: #ffcc00;
      border: none;
      cursor: pointer;
      border-radius: 0.3em;
      padding: 0.3em 0.7em;
      font-size: 0.9em;
    }
    #btnContainer button {
      margin-right: 8px;
      margin-top: 1em;
      padding: 0.5em 1em;
      border-radius: 0.5em;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    #show7days {
      background-color: #a3e4d7;
    }
    #showAll {
      background-color: #f5b7b1;
    }
  </style>
</head>
<body>

  <div class="container">
    <img src="header.png" alt="ã¿ã¦ã¾ã›ã‚“ãƒ˜ãƒƒãƒ€ãƒ¼ç”»åƒ" class="header-png" />
    <h1>ã€ã¿ã¦ã¾ã›ã‚“ã€‚ã€</h1>
    <div class="points">ã­ã‚€ãƒï¼š<span id="points">0</span>pt</div>
    <button class="good" onclick="reportNoLook()">ğŸ™ˆ è¦‹ã¦ãªã„ï¼</button>
    <button class="bad" onclick="reportLooked()">ğŸ“± è¦‹ã¡ã‚ƒã£ãŸâ€¦</button>
    <div class="message" id="message"></div>
  </div>

  <div class="container" style="text-align:left;">
    <h2>æ—¥ä»˜åˆ¥ã‚«ã‚¦ãƒ³ãƒˆè¨˜éŒ²</h2>
    <form id="countForm">
      <label for="dateInput">æ—¥ä»˜</label>
      <input type="date" id="dateInput" required />
      <label for="countInput">ã‚«ã‚¦ãƒ³ãƒˆæ•°</label>
      <input type="number" id="countInput" required min="0" />
      <button type="submit">ä¿å­˜</button>
    </form>

    <div id="btnContainer">
      <button id="show7days">ç›´è¿‘7æ—¥é–“è¡¨ç¤º</button>
      <button id="showAll" style="display:none;">å…¨ä»¶è¡¨ç¤º</button>
    </div>

    <table id="countTable" aria-label="ã‚«ã‚¦ãƒ³ãƒˆè¨˜éŒ²ä¸€è¦§">
      <thead>
        <tr><th>æ—¥ä»˜</th><th>ã‚«ã‚¦ãƒ³ãƒˆæ•°</th><th>æ“ä½œ</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
  // ----- ã­ã‚€ãƒï¼ˆãƒã‚¤ãƒ³ãƒˆï¼‰ã‚«ã‚¦ãƒ³ãƒˆéƒ¨åˆ† -----
  const pointEl = document.getElementById("points");
  const messageEl = document.getElementById("message");
  const todayStr = new Date().toLocaleDateString();

  const praises = [
    "ãˆã‚‰ã„ã«ã‚ƒï¼ğŸ¾",
    "ä»Šæ—¥ã‚‚ãŒã‚“ã°ã£ãŸã­ï¼ğŸ˜º",
    "ã‚ˆãå¯ã‚ŒãŸã‹ã«ã‚ƒï¼ŸğŸ’¤",
    "ã‚¹ãƒãƒ›è¦‹ãªã‹ã£ãŸã®ã€å¤©æ‰ã˜ã‚ƒã‚“ï¼âœ¨"
  ];

  const comforts = [
    "ã¾ãŸæ˜æ—¥ãŒã‚ã‚‹ã«ã‚ƒã€‚ğŸˆ",
    "ã¤ã„è¦‹ã¡ã‚ƒã†æ—¥ã‚‚ã‚ã‚‹ã•ã€œ",
    "ãŒã‚“ã°ã‚Šã™ããªã„ã§ã­ğŸ’¤",
    "ã­ã‚€ãƒã¯é€ƒã’ãªã„ã‚ˆâ€¦ï¼"
  ];

  function getPoints() {
    return parseInt(localStorage.getItem("points") || "0");
  }

  function setPoints(val) {
    localStorage.setItem("points", val);
    pointEl.textContent = val;
  }

  function alreadyReported() {
    return localStorage.getItem("lastReport") === todayStr;
  }

  function setReported() {
    localStorage.setItem("lastReport", todayStr);
  }

  function reportNoLook() {
    if (alreadyReported()) {
      messageEl.textContent = "ä»Šæ—¥ã¯ã‚‚ã†è¨˜éŒ²æ¸ˆã¿ã ã‚ˆğŸ¾";
      return;
    }
    const current = getPoints();
    setPoints(current + 1);
    setReported();
    messageEl.textContent = praises[Math.floor(Math.random() * praises.length)];
  }

  function reportLooked() {
    if (alreadyReported()) {
      messageEl.textContent = "ä»Šæ—¥ã¯ã‚‚ã†è¨˜éŒ²æ¸ˆã¿ã ã‚ˆğŸ¾";
      return;
    }
    setReported();
    messageEl.textContent = comforts[Math.floor(Math.random() * comforts.length)];
  }

  // åˆæœŸãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º
  setPoints(getPoints());

  // ----- æ—¥ä»˜åˆ¥ã‚«ã‚¦ãƒ³ãƒˆè¨˜éŒ²éƒ¨åˆ† -----
  const form = document.getElementById('countForm');
  const dateInput = document.getElementById('dateInput');
  const countInput = document.getElementById('countInput');
  const tbody = document.querySelector('#countTable tbody');

  let counts = JSON.parse(localStorage.getItem('counts') || '{}');
  let editingDate = null;

  function renderTable() {
    tbody.innerHTML = '';
    const dates = Object.keys(counts).sort();
    dates.forEach(date => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${date}</td>
        <td>${counts[date]}</td>
        <td><button class="edit" data-date="${date}">ç·¨é›†</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  function parseDate(str) {
    return new Date(str + 'T00:00:00');
  }

  function renderLast7Days() {
    tbody.innerHTML = '';
    const today = new Date();
    const sevenDaysAgo = new Date(today);
    sevenDaysAgo.setDate(today.getDate() - 6); // ä»Šæ—¥å«ã‚€7æ—¥é–“

    const dates = Object.keys(counts)
      .filter(dateStr => {
        const d = parseDate(dateStr);
        return d >= sevenDaysAgo && d <= today;
      })
      .sort();

    dates.forEach(date => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${date}</td>
        <td>${counts[date]}</td>
        <td><button class="edit" data-date="${date}">ç·¨é›†</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  form.addEventListener('submit', e => {
    e.preventDefault();
    const date = dateInput.value;
    const count = Number(countInput.value);

    if (!date) {
      alert('æ—¥ä»˜ã‚’é¸ã‚“ã§ãã ã•ã„');
      return;
    }
    if (count < 0 || isNaN(count)) {
      alert('æ­£ã—ã„ã‚«ã‚¦ãƒ³ãƒˆæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }

    counts[date] = count;
    localStorage.setItem('counts', JSON.stringify(counts));
    editingDate = null;
    form.reset();
    renderTable();
  });

  tbody.addEventListener('click', e => {
    if (e.target.classList.contains('edit')) {
      const date = e.target.dataset.date;
      dateInput.value = date;
      countInput.value = counts[date];
      editingDate = date;
    }
  });

  document.getElementById('show7days').addEventListener('click', () => {
    renderLast7Days();
    document.getElementById('show7days').style.display = 'none';
    document.getElementById('showAll').style.display = 'inline-block';
  });

  document.getElementById('showAll').addEventListener('click', () => {
    renderTable();
    document.getElementById('show7days').style.display = 'inline-block';
    document.getElementById('showAll').style.display = 'none';
  });

  // åˆæœŸè¡¨ç¤ºã¯å…¨ä»¶è¡¨ç¤º
  renderTable();

</script>
</body>
</html>
